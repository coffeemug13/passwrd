<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/css/bootstrap.min.css" integrity="sha384-AysaV+vQoT3kOAXZkl02PThvDr8HYKPZhNT5h/CXfBThSRXQ6jW5DO2ekP5ViFdi" crossorigin="anonymous">

    <style>
    .bg {
        background-image: url(background1.jpg);
        background-position: 0% 25%;
        background-size: cover;
        background-repeat: no-repeat;
    }
    .icon {
      width: 16px;
      height: 16px;
      margin-bottom:2px
    }
    .display-3 {
    font-size: 4rem;
    font-weight: 400;
    }
    .lead {
    font-size: 1.25rem;
    font-weight: 400;
    }
    .jumbotron {
        padding: 1rem 0rem;
        margin-bottom: 1rem;
    }
    </style>
  </head>
  <body>
      <div class="jumbotron jumbotron-fluid bg">
      <div class="container">
        <h1 class="display-3">PASSWRD</h1>
        <p class="lead">Promise, it's really super easy. If you don't know what to do, <a href="help.html">here</a>  you get further instructions</p>
        <p>
            <a class="btn btn-primary btn-lg" href="help.html" role="button">Learn more</a>
        </p>
      </div>
    </div>
    <div class="container">
        <form role="form" autocomplete="off">
            <div class="form-group">
                <label for="mMaster">Masterkey</label>
                <input type="password" class="form-control" id="mMaster" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="your super secret master password">
            </div>
            <div class="form-group">
                <label for="mUsername">Username</label>
                <input type="text" class="form-control" id="mUsername" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="e.g. testuser or testuser@gmail.com">
            </div>
            <div class="form-group">
                <label for="mDomain">Domain</label>
                <input type="text" class="form-control" id="mDomain" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
                       placeholder="e.g. heise.de or google.com">
            </div>
            <div class="form-group" style="display:None" id="tCounter">
                <label for="mCounter">Counter</label>
                <input type="number" class="form-control" id="mCounter" value="1" min="1" max="99">
            </div>
            <div class="form-group" style="display:None" id="tLength">
                <label for="mLength">Length</label>
                <input type="number" class="form-control" id="mLength" value="10" min="1" max="32">
            </div>
            <div class="form-group" style="display:None" id="tPattern">
                <label for="mPattern">Password Type</label>
                <select class="form-control" id="mPattern">
                    <option value="0" selected="">A-Za-z0-9!@#$%^&*()</option>
                    <option value="1">PIN</option>
                </select>
            </div>
            <div class="form-group">
                <button type="button" class="btn btn-secondary clearfix " onclick="toggle_options()">
                    <img src="svg/chevron-bottom.svg" alt="expand" class="icon pull-left" id="bOptions"/>
                    Options
                </button>
                <button type="button" class="btn btn-primary" onclick="generate()">Generate</button>
            </div>
            <div class="form-group" id="result" style="display:None">
                <label for="passwrd">Domain password</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="passwrd" autocomplete="off" disabled
                           style="font-family: Monospace">
                    <span class="input-group-btn">
                        <button class="btn btn-info" type="button" onclick="copy_to_clipboard()">
                            Copy Clipboard
                        </button>
                    </span>
                </div>
            </div>
        </form>
    </div>

    <!-- jQuery first, then Tether, then Bootstrap JS. -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/js/bootstrap.min.js" integrity="sha384-BLiI7JTZm+JWlgKa0M0kGRpJbF2J8q+qreVrKBC47e3K6BW78kGLrCkeRX6I9RoK" crossorigin="anonymous"></script>
      <script src="js/sha256.js"></script>
    <script type="text/javascript">
    var template = "AEIOUaeiouBCDFGHJKLMNPQRSTVWXYZbcdfghjklmnpqrstvwxyz0123456789!@#$%^&*()"


    function calculate(master, username, domain, counter, length, template) {
        var key = master + ":" + domain.toLowerCase() + ":" + username + ":" + counter
        var hashed_key = Sha256.hash(key, { outFormat: 'hex' })
        console.log("hashed key:" + hashed_key);
        length *= 2 // duplicate length because we are using 2 char
        result = ""
        for (i = 0; i < hashed_key.length ; i=i+2) {
            if (i==length) {
                break
            }
            k = parseInt(hashed_key[i] + hashed_key[i+1], 16)
            kk = k % template.length
            console.log(k + ":"+kk + ":" + template[kk] )
            result += template[kk]
        }
        console.log("generated password: " + result)
        return result
     }


    function generate() {
        var master = $("#mMaster").val();
        if (master=="") {
            $("#mMaster").addClass("bg-warning text-white")
            $("#result").hide();
            return
        } else {
            $("#mMaster").removeClass("bg-warning text-white")
        }
        var username = $("#mUsername").val();
        var domain = $("#mDomain").val();
        var counter = $("#mCounter").val();
        var length = $("#mLength").val();
        pwd = calculate(master, username, domain, counter, length, template)
        $("#passwrd").val(pwd);
        $("#result").show();
        $("html, body").animate({ scrollTop: $(document).height() }, "slow");
       }

    function toggle_options() {
        if($('#tLength').css('display') == 'none') {
            $("#bOptions").attr("src","svg/chevron-top.svg");
        } else {
            $("#bOptions").attr("src","svg/chevron-bottom.svg");
        }
        $("#tCounter").toggle()
        $("#tLength").toggle()
        $("#tPattern").toggle()

    }

    function copy_to_clipboard() {
      window.prompt("Copy to clipboard: Ctrl+C, Enter", $("#passwrd").val());
    }
    // populate the document
    $(document).ready(function () {
        $('#mMaster').hover(function () {$('#mMaster').attr('type', 'text');},
                            function () {$('#mMaster').attr('type', 'password');});
    });

    </script>

  </body>
</html>